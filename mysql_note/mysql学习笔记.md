# 一、数据库基础

## 1.1	数据库和表

**数据库（database）：**保存有组织的数据的容器（通常是一个文件或一组文件）

**表：**某种特定类型数据的结构化清单。在你将资料放入自己的文件柜时，并不是随便将它们扔进某个抽屉就完事了，而是在文件柜中创建文件，然后将相关的资料放入特定的文件中。在数据库领域中，这种文件称为表。表示一种结构化的文件，可用来存储某种特定类型的数据。

关键的一点在于，存储在表中的数据是一种类型的数据或一个清单。绝不应该将顾客的清单与订单的清单存储在同一个数据库中。数据库中的每一个表都有一个用来标识自己的名字，这个名字是**唯一的**。

**模式（schema）：**关于数据库和表的布局及特性的信息。



## 1.2	列和行

**列（column）：**表中的一个字段。所有表都是由一个或多个列组成的。

**行（row）：**表中的一个记录。表中的数据是按行存储的，所保存的每个记录存储在自己的行内。如果将表想象为网格，网格中垂直的列为表列，水平行为表行。

## 1.3	数据类型和主键

**数据类型（datatype）：**所容许的数据的类型。每一个表列都有相应的数据类型，它限制（容许）该列中存储的数据。数据类型定义列可以存储的数据种类，例如列中存储的为数字（或许是订单中的物品数），则相应的数据类型应该为数值类型。如果列中存储的是日期、文本、注释、金额等，则应该用恰当的数据类型规定出来。

**主键（primary key）：**一列（或一组列），其值能够唯一标识表中每个行。表中的任何列都可以作为主键，只要它满足以下条件：

- 任意两行都不具有相同的主键值；
- 每个行都必须具有一个主键值（主键列不允许为NULL值）；
- 主键列中的值不允许修改或更新；
- 主键值不能重用（如果某行从表中删除，它的主键不能赋给以后的新行）

主键通常定义在表的一列上，但这并不是必须的，也可以一起使用多个列作为主键。在使用多列作为主键时，上述条件必须应用到构成主键的所有列，所有列值的组合必须是唯一的（单个列的值可以不唯一）



## 1.4	什么是SQL

SQL（发音为字母S-Q-L或sequel）是结构化查询语言（Structured Query Language）的缩写。SQL是一种专门用来与数据库通信的语言。具有入下优点：

- SQL不是某个特定数据库供应商专有的语言。几乎所有重要的DBMS都支持SQL。
- SQL简单易学。它的语句全都是由很强描述性的英语单词组成，而且这些单词的数量不多。
- SQL尽管看上去很简单，但它实际上式一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作。

# 二、检索数据



## 2.1	SELECT语句与关键字

**SELECT语句：**它的用途是从一个或多个表中检索信息。为了使用SELECT检索表数据，必须至少给出两条信息——想选择什么，以及从什么地方选择。

**关键字（keyword）：**作为SQL组成部分的保留字。关键字不能用作表或列的名字。附录E列出了某些经常使用的保留字。

## 2.2	检索单个列

```mysql
SELECT columnName FROM tableName;
# 或者：
SELECT columnName
FROM tableName;
# 从tableName表中检索一个名为columnName的列。
```

如上的一条简单SELECT语句将返回表中素有行。数据没有过滤（过滤将得出结果集的一个子集），也没有排序。

**使用空格：**在处理SQL语句时，其中所有空格都被忽略。SQL语句可以在一行上给出，也可以分成许多行。

**结束SQL语句：**多条SQL语句必须以分号（ ; ）分割。但Sybase Adaptive Server是个例外，它不允许SQL语句以分号结束。

**SQL语句和大小写：**SQL语句**不区分**大小写，因此SELECT、select、Select是相同的。



## 2.3	检索多个列

```mysql
SELECT columnName1, columnName2, columnName3 FROM tableName;
# 在选择多个列时，一定要在列名之间加上逗号，但最后一个列名后不加。如果在最后一个列名后加了逗号，将出现错误。
```



## 2.4	检索所有列

```mysql
SELECT * FROM tableName;
# 给定一个通配符（ * ），则返回表中所有列。
```

**通配符（*）的使用：**一般，除非你确实需要表中的每个列，否则最好别使用 *通配符。检索不需要的列通常会降低检索和应用程序的性能。

# 三、排序检索数据

## 3.1	排序数据与子句

**子句（clause）：**SQL语句由子句构成，有些子句是必须的，而有的可选。一个子句通常由一个关键字加上所提供的数据组成。

**排序单列数据：**

```mysql
SELECT columnName FROM tableName ORDER BY columnName;
# 使用ORDER BY子句对SELECT语句检索出的数据进行排序。ORDER BY子句去一个或多个列的名字，据此对输出进行排序。
```

**ORDER BY子句的位置：**在指定一条 `ORDER BY` 子句时，应保证它是`SELECT`语句中最后一条子句。该子句的次序不对，将会出现错误信息。

**通过非选择列进行排序：**通常，`ORDER BY`子句中使用的列将是为显示所选择的列，但是，实际上并不一定要这样，用非检索的列排序数据是完全合法的。



## 3.2	按多个列排序

```mysql
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY columnName1, columnName2;
```

在按多个列排序时，排序的顺序完全按所规定的进行。**在多个行具有相同的columnName1值时才会对产品按columnName2进行排序；如果columnName1列中所有值都是唯一的，则不会按columnName2排序**。



## 3.3	按列位置排序

```mysql
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY 1, 2;
```

此语句的输出与上面3.2的输出相同，不同在于`ORDER BY`子句。这里的`ORDER BY 1`表示按`SELECT`后面列名中的第一个列，columnName1进行排序。`ORDER BY 1, 2`表示先按columnName1排序，再按columnName2排序。



## 3.4	指定排序方向

**单个列指定方向：**

```mysql
# 按columnName1升序排列
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY columnName1; ## ORDER BY columnName1 ASC;

# 按columnName1降序排列
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY columnName1 DESC;
# 为了进行降序排序，必须指定DESC关键字。
```

**多个列指定方向：**

```mysql
# 按columnName1降序，columnName2降序排列
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY columnName1 DESC, columnName2; ## ORDER BY columnName1 DESC, columnName2 ASC;

# 按columnName1降序，columnName2也降序排列排列
SELECT columnName1, columnName2, columnName3 
FROM tableName 
ORDER BY columnName1 DESC, columnName2 DESC;
# 为了进行降序排序，必须指定DESC关键字。
```

**在多个列上降序排序：**如果想在多个列上进行降序排序，必须对每个列指定`DESC`关键字。

# 四、过滤数据

## 4.1	使用WHERE子句

- 数据库表一般包含大量的数据，很少需要检索表中所有行。通常只会根据特定操作或报告的需要提取表数据的子集。只检索所需数据需要指定**搜索条件（search criteria）**，搜索条件也称为**过滤条件（filter condition）**。

```mysql
SELECT columnName1, columnName2
FROM tableName 
WHERE columnName1 = col_value;
# 数据根据WHERE子句中指定的搜索条件进行过滤，即返回columnName1的值为col_value的行。
```

**WHERE子句的位置：**在同时使用`order by`和`where`子句时，应该让`order by`位于`where`之后，否则将会产生错误。

## 4.2	WHERE子句操作符

|  操作符   |        说明        |
| :-------: | :----------------: |
|    `=`    |        等于        |
|   `<>`    |       不等于       |
|   `!=`    |       不等于       |
|    `<`    |        小于        |
|   `<=`    |      小于等于      |
|   `!<`    |       不小于       |
|    `>`    |        大于        |
|   `>=`    |      大于等于      |
|   `!>`    |       不大于       |
| `BETWEEN` | 在指定的两个值之间 |
| `IS NULL` |      为NULL值      |

**操作符兼容：**上表中列出的某些操作符是冗余的（如`<>`与`!=`相同，`!<`相当于`>=`）。并非所有的DBMS都支持这些操作。



### 4.2.1	检查单个值

```mysql
SELECT prod_name, prod_price
FROM Products 
WHERE prod_price < 20;

SELECT prod_name, prod_price
FROM Products 
WHERE prod_price > 20;
```



### 4.2.2	不匹配检查

```mysql
SELECT prod_name, prod_price
FROM Products 
WHERE prod_name != '香蕉';
# 等价于下面（如果DBMS支持）
SELECT prod_name, prod_price
FROM Products 
WHERE prod_name <> '香蕉';

```

**何时使用引号：**单引号用来限定字符串。如果将值与串类型的列进行比较，则需要限定引号。用来与数值列进行比较的值不用管引号。



### 4.2.3	范围值检查

为了检查某个范围的值，可使用`BETWEEN...AND...`操作符。其语法与其他`where`子句的操作符稍有不同，因为它需要两个值，即范围的开始值和结束值。

```mysql
SELECT prod_name, prod_price
FROM Products 
WHERE prod_price BETWEEN 5 AND 10;
```

在使用`between`时，必须指定两个值——所需范围的低端和高端值。这两个值必须用**`AND`关键字分割**。`between`匹配范围中所有的值，**包括指定的开始和结束值**。



### 4.2.4	空值检查

在创建表时，表设计人员可以指定其中的列是否可以不包含值。在一个列不包含值时，称其为包含空值NULL。

**NULL：**无值（no value），它与字段包含0、空字符串或仅仅包含空格不同。

`select`语句有一个特殊的`where`子句`IS NULL`子句，可用来检查具有`NULL`值的列：

```mysql
SELECT prod_name, prod_price
FROM Products 
WHERE prod_price IS NULL;
```

这条语句返回没有价格（空prod_price字段，不是价格为0）的所有产品，若表中没有这样的行，则没有返回数据。



# 五、高级过滤数据

## 5.1	组合WHERE子句

### 5.1.1	AND操作符

### 5.1.2	OR操作符

### 5.1.3	计算次序

## 5.2	IN操作符

## 5.3	NOT操作符



# 六、用通配符进行过滤

## 6.1	LIKE操作符

### 6.1.1	百分号（%）通配符

### 6.1.2	下划线（_）通配符

### 6.1.3	方括号（[ ])通配符

## 6.2	使用通配符的技巧



# 七、创建计算字段

## 7.1	计算字段

## 7.2	拼接字段

## 7.3	执行算术计算



# 八、使用数据处理函数

## 8.1	函数

## 8.2	使用函数

### 8.2.1	文本处理函数

### 8.2.2	日期和时间处理

### 8.2.3	值处理函数

# 九、汇总数据

## 9.1	聚集函数

### 9.1.1	AVG()函数

### 9.1.2	COUNT()函数

### 9.1.3	MAX()函数

### 9.1.4	MIN()函数

### 9.1.5	SUM()函数

## 9.2	聚集不同值

## 9.3	组合聚集函数

# 十、分组数据

## 10.1	数据分组

## 10.2	创建分组

## 10.3	过滤分组

## 10.4	分组和排序

## 10.5	SELECT子句顺序

# 十一、使用子查询

## 11.1	子查询

## 11.2	利用子查询进行过滤

## 11.3	作为计算字段使用子查询

# 十二、联结表

## 12.1	联结

### 12.1.1	关系表

### 12.1.2	为什么要使用联结

## 12.2	创建联结

## 12.2.1	WHERE子句

### 12.2.1	WHERE子句的重要性

### 12.2.2	内部联结

### 12.2.3	联结多个表

# 十三、创建高级联结

## 13.1	使用表别名

## 13.2	使用不同类型的联结

### 13.2.1	自联结

### 13.2.2	自然联结

### 13.2.3	外部联结

## 13.3	使用带聚集函数的联结

## 13.4	使用联结和联结条件

# 十四、组合查询

## 14.1	组合查询

## 14.2	创建组合查询

### 14.2.1	使用UNION

### 14.2.2	UNION规则

### 14.2.3	包含或取消重复的行

### 14.2.4	对组合查询结果排序

# 十五、插入数据

## 15.1	数据插入

### 15.1.1	插入完整的行

### 15.1.2	插入部分行

### 15.1.3	插入检索出的数据

## 15.2	从一个表复制到另一个表



# 十六、更新和删除数据

## 16.1	更新数据

## 16.2	删除数据

## 16.3	更新和删除的指导原则

# 十七、创建和操纵表

## 17.1	创建表

### 17.1.1	表创建基础

### 17.1.2	使用NULL值

### 17.1.3	指定默认值

## 17.2	更新表

## 17.3	删除表

## 17.4	重命名表

# 十八、使用视图

## 18.1	视图

### 18.1.1	为什么使用视图

### 18.1.2	视图的规则和限制

## 18.2	创建视图

### 18.2.1	利用视图简化复杂的联结

### 18.2.2	用视图重新格式化检索出的数据

### 18.2.3	用视图过滤不想要的值

### 18.2.4	使用视图与计算字段

# 十九、使用存储过程

## 19.1	存储过程

## 19.2	为什么要使用存储过程

## 19.3	执行存储过程

## 19.4	创建存储过程

# 二十、管理事务处理

## 20.1	事务处理

## 20.2	控制事务处理

### 20.2.1	使用ROLLBACK

### 20.2.2	使用COMMIT

### 20.2.3	使用保留点

# 二十一、使用游标

## 21.1	游标

## 21.2	使用游标

### 21.2.1	创建游标

### 21.2.2	使用游标

### 21.2.3	关闭游标

# 二十二、高级SQL特性

## 22.1	约束

### 22.1.1	主键

### 22.1.2	外键

### 22.1.3	唯一约束

### 22.1.4	检查约束

## 22.2	索引

## 22.3	触发器

## 22.4	数据库安全

